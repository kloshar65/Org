;; This buffer is for text that is not saved, and for Lisp evaluation.
;; To create a file, visit it with C-x C-f and enter text in its buffer.
* Восстановление Grub2
Восстановление Grub2 

Grub - это загрузчик, используемый для запуска системы в большинстве дистрибутивов Linux, в том числе и в Linux Mint. Повреждение загрузчика может быть вызвано различными причинами, например, установкой Windows, другого дистрибутива Linux или переразметкой диска, изменением размера и положения разделов на диске и так далее.

В случае с установкой другой системы, чтобы восстановить загрузчик linux mint нам понадобится LiveCD с любым Linux-дистрибутивом. Самая частая задача из этой категории - восстановление Grub после Windows. Если же ошибка возникла из-за работы с разделами или повреждения файловой системы и загрузчик загружается с сообщением Minimal BASH like line editing is supported - это значит что мы можем справиться и без LiveCD своими силами. Конечно, восстановление grub в linux mint с помощью LiveCD системы намного проще, но не всегда под руками есть нужный диск.

В этой статье мы рассмотрим, как выполняется восстановление Grub2 обоими способами. Начнем с более простого способа - с помощью LiveCD. Хотя и статья ориентирована на Linux Mint, но на самом деле подойдет абсолютно для любого дистрибутива, потому что во всех дистрибутивах загрузчик один и тот же, и команды такие же, только версии могут немного отличаться.

## <a id="_Grub2_LiveCD"></a>Восстановление Grub2 с помощью LiveCD

Начнем с того, что вам нужна LiveCD система, той же разрядности, что и ваша система Linux Mint, на которую был установлен Grub. Причем, неважно будет там графический интерфейс или нет. Обычно все необходимые инструменты поддерживаются всеми дистрибутивами. А нужны нам только утилиты fdisk, mount и chroot. Чтобы восстановить загрузчик grub2 просто следуйте описанным ниже шагам.

### <a id="_1_LiveCD"></a>Шаг 1\. Загрузка LiveCD

Сначала вставьте носитель с LiveCD системой в дисковод или порт USB, если это флешка. Для загрузки с носителя, возможно, вам сначала понадобится зайти в меню BIOS и выставить приоритет загрузки с внешнего устройства.

Для запуска BIOS нажмите Del, F2, F8 или Shift +F2. В открывшимся меню перейдите на вкладку Boot, и в пункте **Boot Device Priority** или **1st Boot Device** выберите нужное устройство:

[![BIOS Boot Section](../_resources/d38f40dbd5394a42b2cf3400e3b9aac1.gif)](https://losst.ru/wp-content/uploads/2015/10/BIOS-Boot-Section.gif)

Дальше перейдите на вкладку **Exit** и выберите **Exit & Save settings.**

Дальше начнется загрузка образа.

### <a id="_2"></a>Шаг 2\. Определение разделов

Перед тем как восстановить Grub2, нам нужно понять - на каком разделе установлена система, и на каком разделе были или должны быть файлы загрузчика. Самый простой способ это сделать - воспользоваться утилитой fdisk.

`sudo fdisk -l`

`Disk /dev/sdc: 14,5 GiB, 15514730496 bytes, 30302208 sectors  
Units: sectors of 1 * 512 = 512 bytes  
Sector size (logical/physical): 512 bytes / 512 bytes  
I/O size (minimum/optimal): 512 bytes / 512 bytes  
Disklabel type: dos  
Disk identifier: 0x38972eb0`

`Device Boot Start End Sectors Size Id Type  
/dev/sdc1 * 23949312 29882367 5933056 2,8G 7 HPFS/NTFS/exFAT  
/dev/sdc2 29882368 30302207 419840 205M b W95 FAT32  
/dev/sdc3 13551616 23949311 10397696 5G 83 Linux  
/dev/sdc4 2048 12621823 12619776 6G b W95 FAT32`

В выводе программы вы видите \- все подключенные к компьютеру разделы, их размер, а также файловую систему. По этим данным вам и предстоит понять, какой раздел используется в качестве корня в вашей системе. Если вы делали разметку вручную, вам не составит труда понять где то, что нужно. Например, у меня загрузчик установлен на раздел /dev/sdc2 размером 205Мб с файловой системой Fat32, а корень - /dev/sdc3 - размером 5 Гигабайт.

### <a id="_3"></a>Шаг 3\. Монтирование файловой системы

Теперь вам предстоит смонтировать вашу корневую файловую систему в каталог /mnt:

`mount /dev/sdc3 /mnt`

Смонтируем папку с файлами загрузчика:

`mount /dev/sdc2 /mnt/boot`

### <a id="_4"></a>Шаг 4\. Подготовка к входу в систему

Чтобы восстановить загрузчик linux mint мы будем использовать вашу основную систему Linux, запущенную на ядре от LiveCD. Такую возможность предоставляет команда chroot. Но перед тем, как ее использовать нужно вручную подключить к вашей корневой ФС, смонтированной в /mnt все необходимые файловые системы взаимодействия с ядром - /dev, /sys, /proc:

`sudo mount --bind /dev /mnt/dev`

`$ sudo mount --bind /sys /mnt/sys`

`$ sudo mount --bind /proc /mnt/proc`

### <a id="_5"></a>Шаг 5\. Вход в окружение системы

Для входа в окружение вашей системы используйте команду:

`chroot /mnt /bin/bash`

Первый параметр указывает папку, в которую была смонтирована корневая файловая система, а второй \- оболочка, используемая для интерпретации команд пользователя.

Затем выполните эти команды для загрузки и обновления переменных профиля:

`env-update`

`$ source /etc/profile`

Теперь вы находитесь в Linux Mint, и можете выполнять почти все его программы, разумеется, недоступны сервисы, поскольку во время загрузки не использовалась система инициализации, а также как следствие, недоступно графическое окружение.

### <a id="_6_Grub2"></a>Шаг 6\. Восстановление Grub2

Теперь восстановление Grub в Linux Mint. Просто выполните следующие команды. Первая, для переустановки загрузчика на жесткий диск:

`sudo grub2-install /dev/sdc`

Здесь /dev/sdc - имя вашего жесткого диска.

Теперь создадим новый конфигурационный файл:

`sudo grub2-mkconfig -o /boot/grub/grub.cfg`

Путь к конфигурационному файлу может немного отличаться, так что будьте внимательны.

Еще можно использовать команду:

`sudo grub-update`

Но она работает только в Ubuntu и основанных на ней дистрибутивах.

### <a id="_7"></a>Шаг 7\. Готово

Выйдите из окружения chroot командой:

`exit`

И перезагрузите компьютер:

`reboot`

Теперь все работает.

## <a id="_Grub2_LiveCD-2"></a>Восстановление Grub2 без LiveCD

В некоторых случаях повреждения Grub не вызывает полную невозможность загрузки. Например, когда загрузочный код в MBR цел, но программа не может получить доступ к файлам на диске. Тогда загрузчик открывает вместо меню некое подобие терминала с сообщением: Minimal BASH like line editing is supported. С помощью этого терминала мы можем попытаться загрузить систему. Восстановление grub2 без livecd не такая уж и сложная задача, хотя, это сложнее, чем первый способ.

Все что вам потребуется \- это знать на каком устройстве расположена система и само ядро Linux. Синтаксис и команды очень похожи на обычные команды bash, но немного отличаются по назначению. В начальном режиме восстановления доступны только несколько команд это ls, insmod, set и unset.

Чтобы посмотреть список подключенных к компьютеру дисков просто выполните:

`ls`

`(hd2,msdos1, hd2,msdos2, hd2,msdos3, hd2,msdos4)`

Важно отметить, что в grub диски и разделы именуются немного по другому. Здесь каждый жесткий диск имеет название hd и номер диска, например, hd0 или hd1. Разделы именуются начиная с единицы.

Вы можете работать только с одним разделом в определенный момент. Чтобы установить раздел, с которым нужно работать, нужно указать его в переменной root. Для установки переменных окружения используется команда set. Например, у меня файлы загрузчика grub находятся на /dev/sdc2, то-есть hd2,2:

`set root=(hd2,2)`

Загрузим нормальную оболочку grub:

`insmod ext2  
$ insmod normal  
$ normal`

После этого можно найти и запустить ядро. Для этого используйте команду linux. Обычно ядро находится папке /boot:

`linux /boot/vmlinuz`

И наконец загружаемся:

`boot`

Теперь, когда система загрузится, вам останется только открыть терминал, и выполнить следующие команды,  чтобы завершить восстановление загрузчика linux mint:

`sudo grub2-install /dev/sda`

`$ sudo grub2-mkconfig -o /boot/grub/grub.cfg`

Вот и все.

## <a id="i"></a>Выводы

Теперь восстановление загрузчика linux mint не вызовет у вас проблем в любых обстоятельствах, независимо от того, есть ли у вас диск с другим дистрибутивом или нет. Если остались вопросы, напишите в комментариях!

### Оцените статью:

![](../_resources/598b260c22b6413e8f87ded3466e8865.gif) Загрузка...
* восстановить GRUB
восстановить GRUB

![ea49f0e183e3c77c950a6127f68b63d3.png](../_resources/e2d27db49ca0421baefb728c2a378d9c.png)
В данной статье рассматривается процесс восстановления загрузчика GRUB 2.

Причины, по которым может понадобится восстановить GRUB, могут быть разными.

Очень часто требуется восстанавливать GRUB после установки Windows. Если у вас был установлен Linux и вы установили в соседний раздел или на соседний диск Windows, то после перезагрузки компьютера загрузится Windows, как будто Linux вообще пропал. Загрузчик GRUB даже не появился. Иногда подобное происходит при обновлении существующего Windows.

Иногда требуется восстановление GRUB после установки Linux, когда неверно был выбран раздел для установки загрузчика.

Во всех случаях нужно выполнить восстановление загрузчика GRUB. Существуют разные способы восстановления. В данном руководстве рассматривается процесс использованием загрузочного Live-образа Linux. Загрузившись в Live-систему вам нужно будет ввести несколько команд, чтобы выполнить восстановление. Рассматривается способ восстановления без использования сторонних программ.

Также иногда различают процесс восстановления для систем с BIOS и с UEFI. Описанный ниже способ рассматривает оба этих случая. Я тестировал его как на компьютерах с традиционным BIOS, так и с UEFI.

** Подготовка

Для восстановления GRUB потребуется загрузочный диск или флешка с дистрибутивом Linux. Если у вас его нет, то нужно скачать образ с дистрибутивом. Например, можно скачать ISO образ Ubuntu.

Для создания загрузочной флешки можно воспользоваться программой Etcher[](https://pingvinus.ru/program/etcher). Она работает в Linux, Windows и MacOS. Подробная инструкция: Как создать загрузочную флешку.[](https://pingvinus.ru/note/live-usb)

** Загрузка в Live-режиме
Теперь нужно загрузиться с созданного диска или флешки.

Чтобы это сделать сначала нужно в BIOS выбрать приоритет загрузки с CD/DVD или с USB (если вы используете флешку).

На современных компьютерах, где используется BIOS/UEFI, для входа в BIOS нужно при включении компьютера удерживать специальную клавишу. У разных производителей клавиша может быть разной. Обычно это: F2, Del, F10, Esc, F11 или F3.

На старых компьютерах, где используется классический BIOS, чтобы войти в BIOS нужно при загрузке компьютера, в самом начале, когда появляется логотип материнской платы, нажать специальную клавишу. Для разных материнских плат клавиша может быть разной. Обычно это одна из клавиш: Del, F1, F2, F8, F10 или какая-нибудь другая, или даже сочетание клавиш. Подробности: [](https://pingvinus.ru/note/bios-boot-setup)

** Открываем терминал

Итак, вы загрузились в Live-режиме. Теперь нужно открыть терминал.
В Ubuntu и некоторых других дистрибутивах это можно сделать нажатием сочетания клавиш Ctrl+Alt+T. Или запустить терминал через меню программ.

** Определение разделов

Теперь нужно определить раздел диска, на котором был установлен GRUB.

Выведем список разделов, для этого выполняем команду (в конце команды стоит строчная буква L):

`sudo fdisk -l`

** Вывод fdisk для BIOS

Пример вывода команды:


![253c1a1f883cf3e786c05432c53135d0.png](../_resources/b10adcc0f3544351a8a1e46e5ca966c2.png)

В моем случае мы видим 2 диска: /dev/sda (SSD диск) и /dev/sdb (флешка, с которой сейчас загружена Live-система).

Нас интересует диск /dev/sda. На диске /dev/sda создано несколько разделов. В моем случае /dev/sda4, на котором установлен Windows, а также 4 раздела с пометкой Linux (см. последний столбец таблицы). У вас скорее всего может быть один раздел Linux (корневой раздел) или два раздела (корневой и home). На одном из этих разделов установлен GRUB.

То есть из таблицы вы должны определить какой раздел является корневым, на нем скорее всего у вас установлен GRUB. В моем случае GRUB установлен в раздел /dev/sda2. Далее по тексту я буду его использовать (вы должны будете указывать свой раздел).

Иногда бывает, что для загрузчика GRUB выделен отдельный раздел (он называется boot-раздел). Если это так, то на следующем шаге вам нужно будет примонтировать корневой раздел и раздел с загрузчиком.

** Вывод fdisk для UEFI

Для новых компьютеров с UEFI вывод команды fdisk -l может быть примерно следующим:

![256e42f7c09277125eea67bcd35eb084.png](../_resources/b70d1f281cdb4414b4eac6166030f1d9.png)

Нам нужно определить, на каком разделе установлен Linux (корневой раздел), а также определить EFI-раздел. В моем случае это разделы: /dev/nvme0n1p5 и /dev/nvme0n1p1, которые расположены на диске /dev/nvme0n1.

** Монтирование разделов

Примонтируем корневой раздел. Выполняем команду (вместо /dev/sda2 вы должны указать свой раздел):
`sudo mount /dev/sda2 /mnt`
Если для загрузчика у вас выделен отдельный раздел, то нужно примонтировать еще и его (вместо /dev/sdX укажите ваш boot-раздел):
`sudo mount /dev/sdX /mnt/boot`
Теперь можно посмотреть содержимое директории /mnt, чтобы убедиться, что мы примонтировали верный раздел:
`ls /mnt`
Вывод команды должен быть примерно следующим. Обратите внимание есть ли в этом списке каталог /boot, так как именно в нем установлен GRUB.


![8a94037647dd950866016e46f7584a2f.png](../_resources/de8a2fd9f10549ae9cf7cbaf97b94161.png)

Также можно проверить, что директория boot не пустая:

`ls /mnt/boot`

У меня вывод команды выглядит следующим образом. Обратите внимание на присутствие каталога с именем grub.


![3d54b3ff6b97a93481440ff9ec921c16.png](../_resources/1f0262317ec24bf5b5cad5badf6e3d80.png)

Далее нужно создать ссылки на несколько директорий, к которым GRUB должен иметь доступ для обнаружения всех операционных систем. Для этого выполните команды:
```
sudo mount --bind /dev /mnt/dev
sudo mount --bind /dev/pts /mnt/dev/pts
sudo mount --bind /proc /mnt/proc
sudo mount --bind /sys /mnt/sys
```


![dd5d9a603f7ac9bdd063358980f4dc6f.png](../_resources/ccdebded94cf4e88ab2097f7bcc3e583.png)




** Монтирование EFI-раздела

Если у вас используется UEFI, то еще нужно примонтировать EFI-раздел в директорию /mnt/boot/efi (выше я указал пример вывода команды fdisk -l в котором показан EFI-раздел):

`sudo mount /dev/nvme0n1p1 /mnt/boot/efi`

** Выполняем chroot на /mnt

На предыдущем шаге мы смонтировали все необходимые директории в директорию /mnt. Теперь переключимся (выполним chroot) на данную директорию. Выполняем команду:

`sudo chroot /mnt`



![0bb05c81bfd9f040d098cc1ba74f3975.png](../_resources/23d911e00f3247b9bb8aceb64e1298ed.png)


** Генерация файла конфигурации GRUB

Данный шаг нужно выполнять не всем. Если у вас был установлен GRUB и вы уверены, что его конфигурация верная, то можно перейти к следующему шагу.

Для генерации файла конфигурации GRUB используется команда update-grub. Данная команда автоматически определяет файловые системы на вашем компьютере и генерирует новый файл конфигурации. Выполняем команду:

`sudo update-grub`
В выводе команды будет показано, какие операционные системы были найдены.



![77072d78e9231c1f902cdcfc7ee261ba.png](../_resources/3018ef3490c3425a95772f75573ccb0e.png)



Если вдруг утилита update-grub не определила ваш Windows (у меня такое было для UEFI), то можно будет запустить update-grub повторно уже из вашей Linux-системы, когда вы в нее загрузитесь (мне это помогло и Windows определился).


** Устанавливаем GRUB

Осталось выполнить установку GRUB на диск. Мы определили раздел на котором у нас установлен GRUB на первом шаге данного руководства. В моем случае это раздел /dev/sda2, который расположен на диске /dev/sda.

Для установки GRUB используется команда grub-install, которой нужно передать в качестве параметра диск, на который будет выполняться установка (в моем случае это диск /dev/sda):

`grub-install /dev/sda`



![8d9bd7e416e50e5185164971f1e49c26.png](../_resources/51b317164ace44be990ebd49ca2ee8b2.png)

https://askubuntu.com/questions/88384/how-can-i-repair-grub-how-to-get-ubuntu-back-after-installing-windows
If Ubuntu is installed in EFI mode, and EFI partition UUID has changed, you may need to update it in /etc/fstab. Compare it:
blkid | grep -i efi
grep -i efi /etc/fstab

** Перезагрузка компьютера

Выходим из окружения chroot, для этого выполняем команду:

`exit`
Отмонтируем все разделы, которые мы примонтировали:
```
sudo umount /mnt/sys
sudo umount /mnt/proc
sudo umount /mnt/dev/pts
sudo umount /mnt/dev
```
Если вы монтировали boot-раздел, то его тоже нужно отмонтировать:

`sudo umount /mnt/boot`
Если вы монтировали EFI-раздел, отмонтируем:

`sudo umount /mnt/boot/efi`
Отмонтируем корневой раздел:

`sudo umount /mnt`
Перезагружаем компьютер. Для этого выполняем команду:

`reboot`

Если во время перезагрузки компьютера меню GRUB не появилось, то это еще не значит, что он не восстановился. Возможно, просто установлена нулевая задержка и меню не показывается. Чтобы показать меню GRUB нужно во время загрузки, после того, как появился логотип материнской платы:

удерживать клавишу Shift, если у вас классический BIOS;
нажать Esc, если у вас UEFI.
Если у вас, при выполнении grub-update, не определился Windows и не был добавлен в меню GRUB, то уже загрузившись в вашу систему Linux (не LiveCD), откройте терминал и выполните:

`sudo grub-update`
Мне это помогло на компьютере, который использует UEFI.

** Шпаргалка

Мы рассмотрели процесс восстановления загрузчика GRUB 2. Для удобства привожу краткую шпаргалку по командам, которые мы выполняли. Учитывайте, что названия и имена разделов (/dev/sd...) у вас могут отличаться.
```
sudo fdisk -l
sudo mount /dev/sda2 /mnt
# sudo mount /dev/sdaX /mnt/boot
# sudo mount /dev/sdaY /mnt/boot/efi
sudo mount --bind /dev /mnt/dev && sudo mount --bind /dev/pts /mnt/dev/pts && sudo mount --bind /proc /mnt/proc && sudo mount --bind /sys /mnt/sys
sudo chroot /mnt
sudo update-grub
grub-install /dev/sda

```

